generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TRAINER
  MEMBER
}

enum MuscleGroup {
  ALL
  CHEST
  BACK
  SHOULDERS
  ARMS
  CORE
  LEGS
  CARDIO
}

enum SubMuscle {
  UPPER_CHEST
  MIDDLE_CHEST
  LOWER_CHEST
  UPPER_BACK
  LATS
  LOWER_BACK
  FRONT_DELTS
  SIDE_DELTS
  REAR_DELTS
  BICEPS_LONG_HEAD
  BICEPS_SHORT_HEAD
  BRACHIALIS
  TRICEPS_LONG_HEAD
  TRICEPS_LATERAL_HEAD
  TRICEPS_MEDIAL_HEAD
  UPPER_ABS
  LOWER_ABS
  OBLIQUES
  QUADS
  HAMSTRINGS
  GLUTES
  CALVES
}

enum Difficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum ProgressStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

model User {
  userId      Int       @id @default(autoincrement())
  userName    String
  email       String    @unique
  password    String
  dateOfBirth DateTime?
  gender      String?
  bio         String?
  phoneNumber String?
  role        Role      @default(MEMBER)

  admin   Admin?
  trainer Trainer?
  member  Member?

  routines Routine[]
}

model Admin {
  adminId Int  @id
  user    User @relation(fields: [adminId], references: [userId])
}

model Trainer {
  trainerId        Int    @id
  user             User   @relation(fields: [trainerId], references: [userId])
  certificate      String
  specialization   String
  experiencedYears Int
  clientTypes      String

  members  Member[]
  workouts Workout[]

  chats Chat[]
}

model Member {
  memberId     Int      @id
  user         User     @relation(fields: [memberId], references: [userId])
  goal         String?
  medicalNotes String?
  trainerId    Int?
  trainer      Trainer? @relation(fields: [trainerId], references: [trainerId])

  progress      Progress[]
  savedWorkouts SavedWorkouts[]
  savedRoutines SavedRoutines[]

  chats Chat[]

  createdAt DateTime @default(now())
}

model Workout {
  workoutId   Int         @id @default(autoincrement())
  workoutName String
  trainerId   Int? // optional
  description String
  difficulty  Difficulty
  muscleGroup MuscleGroup
  subMuscle   SubMuscle
  equipment   String?

  routineWorkouts Routine_Workout[]
  progress        Progress[]
  savedWorkouts   SavedWorkouts[]

  trainer Trainer? @relation(fields: [trainerId], references: [trainerId]) // <-- optional
}

model Routine {
  routineId   Int        @id @default(autoincrement())
  routineName String
  difficulty  Difficulty
  type        String
  duration    Int
  calories    Int
  description String?
  isPrivate   Boolean    @default(false)

  createdById Int?
  createdBy   User? @relation(fields: [createdById], references: [userId])

  routineWorkouts Routine_Workout[]
  progress        Progress[]
  savedRoutines   SavedRoutines[]
}

model Routine_Workout {
  routineId   Int
  workoutId   Int
  sets        Int
  reps        Int
  timeMinutes Int?
  calories    Int?
  equipment   String?

  routine Routine @relation(fields: [routineId], references: [routineId])
  workout Workout @relation(fields: [workoutId], references: [workoutId])

  @@id([routineId, workoutId])
}

model Progress {
  progressId  Int            @id @default(autoincrement())
  memberId    Int
  routineId   Int
  workoutId   Int? 
  sessionId   String
  status      ProgressStatus @default(NOT_STARTED)
  completedAt DateTime?
  isCompleted Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  member  Member   @relation(fields: [memberId], references: [memberId])
  routine Routine  @relation(fields: [routineId], references: [routineId])
  workout Workout? @relation(fields: [workoutId], references: [workoutId])

  @@unique([memberId, routineId, workoutId, sessionId])
}

model SavedWorkouts {
  savedWorkoutId Int      @id @default(autoincrement())
  memberId       Int
  workoutId      Int
  date           DateTime @default(now())

  member  Member  @relation(fields: [memberId], references: [memberId])
  workout Workout @relation(fields: [workoutId], references: [workoutId])

  @@unique([memberId, workoutId])
}

model SavedRoutines {
  savedRoutineId Int      @id @default(autoincrement())
  memberId       Int
  routineId      Int
  date           DateTime @default(now())

  member  Member  @relation(fields: [memberId], references: [memberId])
  routine Routine @relation(fields: [routineId], references: [routineId])

  @@unique([memberId, routineId])
}

model Chat {
  chatId    Int      @id @default(autoincrement())
  memberId  Int
  trainerId Int
  createdAt DateTime @default(now())

  member   Member    @relation(fields: [memberId], references: [memberId])
  trainer  Trainer   @relation(fields: [trainerId], references: [trainerId])
  messages Message[]

  @@unique([memberId, trainerId]) 
}

model Message {
  messageId Int      @id @default(autoincrement())
  chatId    Int
  senderId  Int
  content   String
  createdAt DateTime @default(now())

  chat Chat @relation(fields: [chatId], references: [chatId])
}
